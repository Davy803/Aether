var __extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},ProjectAether;(function(n){var u=function(){function i(i,u){var f=this;this.targetAction=ko.observable(n.TargetActions.None),this.isSelected=ko.observable(!1),this.controller=ko.observable(),this.location=ko.observable(),this.canAttack=ko.observable(!0),this.buffs=ko.observableArray([]),this.name=ko.observable(i),this.damage=new t("damage",u.damage),this.movement=new t("movement",u.movement),this.totalMovement=new t("totalMovement",u.movement),this.life=new t("life",u.life),this.totalLife=new t("totalLife",u.life),this.flying=new r("flying",u.flying),this.canMove=ko.computed(function(){return f.movement.current()>0}),this.nativeBuffs=u.buffs||[]}return i.prototype.enterPlay=function(n,t){this.controller(n),this.location(t),this._applyAllBuffs()},i.prototype.beginTurn=function(){_.each(this._allBuffs(),function(n){return n.appliedThisTurn=!1}),this.canAttack(!0),this.totalMovement.reset(),this.totalLife.reset(),this.damage.reset(),this.movement.current(this.totalMovement.current()),this.location().owner(this.controller()),this._applyAllBuffs()},i.prototype.attack=function(t){n.assert(this.canAttack()),t.takeDamage(this.damage.current()),this.canAttack(!1)},i.prototype.takeDamage=function(n){this.life.subtract(n),this.isAlive()||this._die()},i.prototype.isAlive=function(){return this.life.current()>0},i.prototype.move=function(n,t){this.movement.subtract(t),this.location().setValue(null),this.location(n),n.setValue(this)},i.prototype._allBuffs=function(){return _.union(this.nativeBuffs,this.buffs())},i.prototype._die=function(){this.location().setValue(null),this.location(null),this.controller().creaturesInPlay.remove(this),this.controller(null)},i.prototype._applyAllBuffs=function(){var n=this;_.chain(this._allBuffs()).filter(function(n){return!n.appliedThisTurn}).each(function(t){return t.apply(n)})},i}(),i,t,r;n.Creature=u,i=function(){function n(n,t){this.name=n,this.initial=t;var i=this;this.current=ko.observable(t),this.modified=ko.computed(function(){return i.current()===i.initial})}return n.prototype.reset=function(){this.current(this.initial)},n}(),n.Stat=i,t=function(n){function t(t,i){var r=this;n.call(this,t,i),this.name=t,this.initial=i,this.increased=ko.computed(function(){return r.current()>r.initial}),this.decreased=ko.computed(function(){return r.current()<r.initial})}return __extends(t,n),t.prototype.add=function(n){this.current(this.current()+n)},t.prototype.subtract=function(n){this.current(this.current()-n)},t.prototype.halve=function(){this.current(Math.round(this.current()/2))},t}(i),n.StatNumber=t,r=function(n){function t(t,i){var r=this;n.call(this,t,i),this.name=t,this.initial=i,this.increased=ko.computed(function(){return r.current()&&!r.initial}),this.decreased=ko.computed(function(){return!r.current()&&r.initial})}return __extends(t,n),t.prototype.invert=function(){this.current(!this.current())},t}(i),n.StatBool=r})(ProjectAether||(ProjectAether={}))