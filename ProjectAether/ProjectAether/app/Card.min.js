var Helpers,__extends,viewModel,ProjectAether;(function(n){var t=function(){function n(){var r=this,t=this.constructor,i,n;if(!t.__cb__){t.__cb__={};for(n in this)i=this[n],typeof i=="function"&&n.indexOf("cb_")==0&&(t.__cb__[n]=i)}for(n in t.__cb__)(function(n,t){r[n]=function(){return t.apply(r,Array.prototype.slice.call(arguments))}})(n,t.__cb__[n])}return n}();n.HasCallbacks=t})(Helpers||(Helpers={})),__extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},function(n){var t=function(n){function t(t,i){n.call(this),this.name=t,this.deck=i,this.isCurrentlyValidTarget=ko.observable(!1),this.cardsInHand=ko.observableArray(),this.graveyard=ko.observableArray(),this.mana=ko.observable(0)}return __extends(t,n),t.prototype.init=function(){var n=this;_.times(7,function(){return n._drawCard()}),this.mana(5)},t.prototype.payCost=function(n){this.mana(this.mana()-n)},t.prototype._beginTurn=function(){this._drawCard()},t.prototype._drawCard=function(){this.cardsInHand.push(this.deck.drawCard())},t}(Helpers.HasCallbacks);n.Player=t}(ProjectAether||(ProjectAether={})),function(n){var t=function(){function n(n,t){this.isCurrentlyValidTarget=ko.observable(!1),this.name=ko.observable(n),this.damage=ko.observable(t.damage),this.movement=ko.observable(t.movement),this.life=ko.observable(t.initialLife)}return n}();n.Creature=t}(ProjectAether||(ProjectAether={})),function(n){var t=function(){function n(n,t,i){this.row=n,this.col=t;var r=this;this.isCurrentlyValidTarget=ko.observable(!1),this._value=ko.observable(null),this.owner=ko.observable(),this.value=ko.computed(function(){return r._value()}),this.owner(i)}return n.prototype.setValue=function(n){if(this._value()!==null)throw Error("Value Already Set");this._value(n)},n.prototype.isEmpty=function(){return this._value()==null},n}();n.Space=t}(ProjectAether||(ProjectAether={})),function(n){var t=function(){function n(n){this.cards=n}return n.prototype.drawCard=function(){return this.cards.pop()},n}();n.Deck=t}(ProjectAether||(ProjectAether={})),function(n){var t=function(){function t(t,i,r,u){var o,f,e,s,h;for(this.width=t,this.height=i,o=this,this.spaces=[],s=0,h=t*i,e=0;e<i;e++)for(f=0;f<t;f++)this.spaces.push(new n.Space(e,f,s<h/2?r:u)),s++;this.rows=ko.computed(function(){return _.map(_.range(o.height),function(n){return o._getRow(n)})})}return t.prototype.checkWinner=function(){for(var r,n,i=function(n){return(r=_.chain(n).map(function(n){return n.value()}).uniq().value(),r.length===1)?r[0]:null},t=0;t<this.height;t++)if(n=i(this._getRow(t)),n!==null)return n;for(t=0;t<this.width;t++)if(n=i(this._getCol(t)),n!==null)return n;return(n=i(this._getDiagLeft()),n!==null)?n:(n=i(this._getDiagRight()),n!==null)?n:null},t.prototype._getRow=function(n){for(var i=[],r=n*this.width,u=n*this.width+this.width,t=r;t<u;t++)i.push(this.spaces[t]);return i},t.prototype._getCol=function(n){for(var i=[],r=n,u=this.width*this.height,t=r;t<u;t+=this.width)i.push(this.spaces[t]);return i},t.prototype._getDiagLeft=function(){for(var t=[],i=this.width-1,r=this.width*this.height,n=i;n<r;n+=this.width-1)t.push(this.spaces[n]);return t},t.prototype._getDiagRight=function(){for(var t=[],i=0,r=this.width*this.height,n=i;n<r;n+=this.width+1)t.push(this.spaces[n]);return t},t}(),i;n.Board=t,i=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t}(t),n.HexBoard=i}(ProjectAether||(ProjectAether={})),function(n){var t=function(t){function i(i,r,u,f){t.call(this),this.player1=i,this.player2=r,this.currentPlayer=ko.observable(n.Player),this.currentState=ko.observable(n.States.InProgress),this.currentTurn=ko.observable(1),this.currentAction=ko.observable(),this.currentPlayer(i),this.board=new n.Board(u,f,i,r),i.init(),r.init()}return __extends(i,t),i.prototype.cb_playCard=function(t){var r=this.currentPlayer(),i;t instanceof n.CreatureCard&&(i=new n.Actions.PlayCreatureAction(r,t)),t.isSelected(!0),this.currentAction(i),this._setTargets(i)},i.prototype._setTargets=function(n){var t=this._getTargets(n);_.chain(t).filter(function(t){return n.targetValidator(t)}).each(function(n){return n.isCurrentlyValidTarget(!0)}).value()},i.prototype.cb_selectTarget=function(n){var i=this.currentPlayer(),t=this.currentAction();if(!t.targetValidator(n))throw Error("Not valid target");if(!n.isCurrentlyValidTarget())throw Error("Target validity not set");t.perform(n),this.currentAction(null),this._clearAllTargetValidity()},i.prototype.cb_endTurn=function(){this.currentPlayer()===this.player1?this.currentPlayer(this.player2):this.currentPlayer(this.player1)},i.prototype._getTargets=function(t){var r=this,i=[];return _.forEach(t.targetTypes,function(t){switch(t){case n.TargetTypes.Card:i.push.apply(i,r._getAllCards());break;case n.TargetTypes.Creature:i.push.apply(i,r._getAllCreatures());break;case n.TargetTypes.Player:i.push.apply(i,r._getAllPlayers());break;case n.TargetTypes.Space:i.push.apply(i,r._getAllSpaces());break;default:throw Error("Unknown Target Type: "+t);}}),i},i.prototype._getAllCards=function(){return _.union(this.player1.cardsInHand(),this.player1.deck.cards,this.player2.cardsInHand(),this.player2.deck.cards)},i.prototype._getAllCreatures=function(){return _.chain(this.board.spaces).map(function(n){return n.value}).filter(function(t){return t instanceof n.Creature}).value()},i.prototype._getAllPlayers=function(){return[this.player1,this.player2]},i.prototype._getAllSpaces=function(){return this.board.spaces},i.prototype._getAllTargets=function(){return _.union(this._getAllCards(),this._getAllCreatures(),this._getAllPlayers(),this._getAllSpaces())},i.prototype._clearAllTargetValidity=function(){_.each(this._getAllTargets(),function(n){return n.isCurrentlyValidTarget(!1)})},i}(Helpers.HasCallbacks);n.Game=t}(ProjectAether||(ProjectAether={})),function(n){n.TargetTypes={Card:"Card",Creature:"Creature",Player:"Player",Space:"Space"}}(ProjectAether||(ProjectAether={})),function(n){(function(t){var i=function(n){function t(t){n.call(this,"Centaur",5,t,{damage:5,initialLife:12,movement:3})}return __extends(t,n),t}(n.CreatureCard);t.Centaur=i})(n.Cards||(n.Cards={}));var t=n.Cards}(ProjectAether||(ProjectAether={})),function(n){(function(t){var i=function(n){function t(t){n.call(this,"Faerie",2,t,{damage:2,initialLife:5,movement:8})}return __extends(t,n),t}(n.CreatureCard);t.Faerie=i})(n.Cards||(n.Cards={}));var t=n.Cards}(ProjectAether||(ProjectAether={})),function(n){(function(t){var i=function(n){function t(t){n.call(this,"Unicorn",4,t,{damage:5,initialLife:10,movement:4})}return __extends(t,n),t}(n.CreatureCard);t.Unicorn=i})(n.Cards||(n.Cards={}));var t=n.Cards}(ProjectAether||(ProjectAether={})),function(n){(function(t){var i=function(){function t(t,i){this.player=t,this.card=i,this.targetTypes=[n.TargetTypes.Space]}return t.prototype.targetValidator=function(n){return n.isEmpty()&&n.owner()==this.card.owner},t.prototype.perform=function(n){if(!this.canPerform(n))throw Error("Cannot Play Card");if(!n.isEmpty())throw Error("Cannot cast create on non-empty space");n.setValue(this.card.creature),this.player.cardsInHand.remove(this.card),this.player.payCost(this.card.cost)},t.prototype.performMulti=function(){throw Error("Cannot target multiple spaces");},t.prototype.canPerform=function(){var n=this.player,t=this.card;return _.contains(n.cardsInHand(),t)&&n.mana()>=t.cost},t.prototype.canPerformMulti=function(){throw Error("Cannot target multiple spaces");},t}();t.PlayCreatureAction=i})(n.Actions||(n.Actions={}));var t=n.Actions}(ProjectAether||(ProjectAether={})),function(n){(function(t){function i(n,t,i){return _.map(_.range(40),function(){return new n(i)})}function r(t){return new n.Deck(i(n.Cards.Centaur,40,t))}function u(t){return new n.Deck(i(n.Cards.Faerie,40,t))}function f(t){return new n.Deck(i(n.Cards.Unicorn,40,t))}t.centaurDeck=r,t.faerieDeck=u,t.unicornDeck=f})(n.Decks||(n.Decks={}));var t=n.Decks}(ProjectAether||(ProjectAether={})),function(n){n.States={InProgress:"In Progress",WinnerX:"X Wins",WinnerO:"O Wins",Tie:"Tie"}}(ProjectAether||(ProjectAether={})),window.onload=function(){var t=new ProjectAether.Player("Player 1"),n,i;t.deck=ProjectAether.Decks.centaurDeck(t),n=new ProjectAether.Player("Player 2"),n.deck=ProjectAether.Decks.faerieDeck(n),i=new ProjectAether.Game(t,n,7,6),ko.applyBindings(i),viewModel=i},function(n){var t=function(){function n(n,t,i){this.name=n,this.cost=t,this.owner=i,this.isCurrentlyValidTarget=ko.observable(!1),this.isSelected=ko.observable(!1)}return n}(),i;n.CardBase=t,i=function(t){function i(i,r,u,f){t.call(this,i,r,u),this.creature=new n.Creature(i,f)}return __extends(i,t),i}(t),n.CreatureCard=i}(ProjectAether||(ProjectAether={}))