var Helpers,__extends,viewModel,ProjectAether;(function(n){var t=function(){function n(){var r=this,t=this.constructor,i,n;if(!t.__cb__){t.__cb__={};for(n in this)i=this[n],typeof i=="function"&&n.indexOf("cb_")==0&&(t.__cb__[n]=i)}for(n in t.__cb__)(function(n,t){r[n]=function(){return t.apply(r,Array.prototype.slice.call(arguments))}})(n,t.__cb__[n])}return n}();n.HasCallbacks=t})(Helpers||(Helpers={})),function(n){var t=function(){function n(n){this.name=ko.observable(n)}return n}();n.Creature=t}(ProjectAether||(ProjectAether={})),function(n){var t=function(){function n(n,t){this.row=n,this.col=t;var i=this;this._value=ko.observable(null),this.value=ko.computed(function(){return i._value()})}return n.prototype.setValue=function(n){if(this._value()!==null)throw Error("Value Already Set");this._value(n)},n}();n.Space=t}(ProjectAether||(ProjectAether={})),function(n){var t=function(){function n(n){this.creatures=n}return n.prototype.drawCard=function(){return this.creatures.pop()},n}();n.Deck=t}(ProjectAether||(ProjectAether={})),function(n){var t=function(){function t(t,i){this.width=t,this.height=i;var f=this,r,u;for(this.nodes=[],u=0;u<i;u++)for(r=0;r<t;r++)this.nodes.push(new n.Space(u,r));this.rows=ko.computed(function(){return _.map(_.range(f.height),function(n){return f._getRow(n)})})}return t.prototype.checkWinner=function(){for(var r,n,i=function(n){return(r=_.chain(n).map(function(n){return n.value()}).uniq().value(),r.length===1)?r[0]:null},t=0;t<this.height;t++)if(n=i(this._getRow(t)),n!==null)return n;for(t=0;t<this.width;t++)if(n=i(this._getCol(t)),n!==null)return n;return(n=i(this._getDiagLeft()),n!==null)?n:(n=i(this._getDiagRight()),n!==null)?n:null},t.prototype._getRow=function(n){for(var i=[],r=n*this.width,u=n*this.width+this.width,t=r;t<u;t++)i.push(this.nodes[t]);return i},t.prototype._getCol=function(n){for(var i=[],r=n,u=this.width*this.height,t=r;t<u;t+=this.width)i.push(this.nodes[t]);return i},t.prototype._getDiagLeft=function(){for(var t=[],i=this.width-1,r=this.width*this.height,n=i;n<r;n+=this.width-1)t.push(this.nodes[n]);return t},t.prototype._getDiagRight=function(){for(var t=[],i=0,r=this.width*this.height,n=i;n<r;n+=this.width+1)t.push(this.nodes[n]);return t},t}();n.Board=t}(ProjectAether||(ProjectAether={})),__extends=this.__extends||function(n,t){function i(){this.constructor=n}i.prototype=t.prototype,n.prototype=new i},function(n){(function(t){var i=function(n){function t(){n.call(this,"Centaur")}return __extends(t,n),t}(n.Creature);t.Centaur=i})(n.Creatures||(n.Creatures={}));var t=n.Creatures}(ProjectAether||(ProjectAether={})),function(n){(function(t){var i=function(n){function t(){n.call(this,"Faerie")}return __extends(t,n),t}(n.Creature);t.Faerie=i})(n.Creatures||(n.Creatures={}));var t=n.Creatures}(ProjectAether||(ProjectAether={})),function(n){(function(t){var i=function(n){function t(){n.call(this,"Unicorn")}return __extends(t,n),t}(n.Creature);t.Unicorn=i})(n.Creatures||(n.Creatures={}));var t=n.Creatures}(ProjectAether||(ProjectAether={})),function(n){(function(t){t.CentaurDeck=new n.Deck(_.map(_.range(40),function(){return new n.Creatures.Centaur})),t.FaerieDeck=new n.Deck(_.map(_.range(40),function(){return new n.Creatures.Faerie})),t.UnicornDeck=new n.Deck(_.map(_.range(40),function(){return new n.Creatures.Unicorn}))})(n.Decks||(n.Decks={}));var t=n.Decks}(ProjectAether||(ProjectAether={})),function(n){var t=function(t){function i(i,r,u){typeof u=="undefined"&&(u=3),t.call(this),this.player1=i,this.player2=r,this.currentPlayer=ko.observable(n.Player),this.currentState=ko.observable(n.States.InProgress),this.currentTurn=ko.observable(1),this.currentPlayer(i),this.board=new n.Board(u,u)}return __extends(i,t),i.prototype.cb_move=function(t){if(this.currentState()!==n.States.InProgress)throw Error("Game already completed");t.setValue(this.currentPlayer().creatureToBePlayed()),this.currentTurn(this.currentTurn()+1),this.currentPlayer()===this.player1?this.currentPlayer(this.player2):this.currentPlayer(this.player1),this._checkGameState()},i.prototype._checkGameState=function(){switch(this.board.checkWinner()){case n.Values.X:this.currentState(n.States.WinnerX);break;case n.Values.O:this.currentState(n.States.WinnerO)}this.currentState()===n.States.InProgress&&this.currentTurn()>this.board.width*this.board.height&&this.currentState(n.States.Tie)},i}(Helpers.HasCallbacks);n.Game=t,n.States={InProgress:"In Progress",WinnerX:"X Wins",WinnerO:"O Wins",Tie:"Tie"},n.Values={_:"_",X:"X",O:"O"}}(ProjectAether||(ProjectAether={})),window.onload=function(){var t=new ProjectAether.Player("Player 1",ProjectAether.Decks.CentaurDeck),i=new ProjectAether.Player("Player 2",ProjectAether.Decks.FaerieDeck),n=new ProjectAether.Game(t,i,5);ko.applyBindings(n),viewModel=n},function(n){var t=function(n){function t(t,i){var r=this;n.call(this),this.name=t,this.deck=i,this.creaturesInHand=ko.observableArray(),this.creatureToBePlayed=ko.observable(),_.times(7,function(){return r._drawCard()})}return __extends(t,n),t.prototype.cb_playCreature=function(n){if(!_.contains(this.creaturesInHand(),n))throw Error("You don't own that creature");this.creatureToBePlayed(n)},t.prototype.cb_placeCreature=function(n){n.setValue(this.creatureToBePlayed()),this.creaturesInHand.remove(this.creatureToBePlayed()),this.creatureToBePlayed(null)},t.prototype.cb_drawCard=function(){this._drawCard()},t.prototype._drawCard=function(){this.creaturesInHand.push(this.deck.drawCard())},t}(Helpers.HasCallbacks);n.Player=t}(ProjectAether||(ProjectAether={}))